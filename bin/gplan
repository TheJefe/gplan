#!/usr/bin/env ruby
#
# This script is used to find all of the planbox story numbers from the git log
# For lesson-player it is dependent on lesson-player being in the directory name for the repo

require 'pathname'
bin_path = Pathname.new(__FILE__).realpath
$:.unshift File.expand_path('../../lib', bin_path)
require 'planbox'
require 'github'

STORY_REGEX=/\[(?:fixes)? *#*([0-9]*)\]/i
# MAIN
prod_branch="production/master"
if Dir.pwd.include? "lesson-player"
        `git fetch origin`
        prod_branch="origin/master"
else
        `git fetch production`
end
list= `git log #{prod_branch}..`
pb_story_ids = list.scan(STORY_REGEX).flatten.uniq # find everything between [ and ]
release_notes = Planbox.get_release_notes pb_story_ids
puts release_notes
